<% object.contents.each do |content| %>
  <%= fields_for "contents[#{content.section.id}]", content, namespace: "plans_section_#{content.section.id}" do |content_form| %>
    <% content_form.instance_variable_set(:@template, form.instance_variable_get(:@template)) %>
    <% content = content_form.object %>

    <%= cell(
      content.section_type_manifest.edit_cell,
      content,
      multilingual_answers: component_settings.multilingual_answers?,
      context: {
        form: content_form,
        parent_form: form,
        current_component: current_component
      }
    ) %>

    <%= content_form.hidden_field :id %>
    <%= content_form.hidden_field :section_id %>
  <% end %>
<% end %>

<%
js_options = {
  messages: {
    charactersMin: t(".characters_min"),
    charactersUsed: t(".characters_used")
  }
}
%>
<script>
$(function() {
  DecidimPlansCharacters.configure(<%== js_options.to_json %>);
  $(".field.with-character-counter").each(function(_i, el) {
    var $wrapper = $(el);
    var $input = $("input, textarea", $wrapper);
    var $info = $(".field-character-counter-info", $wrapper);
    DecidimPlansCharacters.bindCharacterCounter($input, $info);
  });
});
</script>
